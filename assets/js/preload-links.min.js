"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function n(e,t){i(this,n),this.browser=e,this.config=t,this.options=this.browser.options,this.prefetched=new Set}return e(n,[{key:"init",value:function(){this.browser.supportsLinkPrefetch()&&!this.browser.isDataSaverModeOn()&&(this.regex={excludeUris:RegExp(this.config.excludeUris,"i"),images:RegExp(".("+this.config.imageExt+")$","i"),fileExtensions:RegExp(".("+this.config.fileExt+")$","i")},this._initListeners(this))}},{key:"_initListeners",value:function(e){document.addEventListener("mousedown",e.listener.bind(e),e.options),document.addEventListener("touchstart",e.listener.bind(e),e.options)}},{key:"listener",value:function(e){var n=this,i=this._prepareUrl(e);null!==i&&new Promise(function(e,t){n._addPrefetchLink(i,e,t)})}},{key:"_addPrefetchLink",value:function(e,t,n){var i;this.prefetched.has(e.href)||(this.prefetched.add(e.href),(i=document.createElement("link")).rel="prefetch",i.href=e.href,i.onload=t,i.onerror=n,document.head.appendChild(i))}},{key:"_prepareUrl",value:function(e){var t=e.target.closest("a");if(null===t||"object"!==(void 0===t?"undefined":o(t))||!1 in t||-1===["http:","https:"].indexOf(t.protocol))return null;var n=t.href.substring(0,this.config.siteUrl.length),i=this._getPathname(t.href,n),r={original:t.href,protocol:t.protocol,origin:n,pathname:i,href:n+i};return this._isLinkOk(r)?r:null}},{key:"_getPathname",value:function(e,t){var n=t?e.substring(this.config.siteUrl.length):e;return n.startsWith("/")||(n="/"+n),this._shouldAddTrailingSlash(n)?n+"/":n}},{key:"_shouldAddTrailingSlash",value:function(e){return this.config.usesTrailingSlash&&!e.endsWith("/")&&!this.regex.fileExtensions.test(e)}},{key:"_isLinkOk",value:function(e){return null!==e&&"object"===(void 0===e?"undefined":o(e))&&(!this.prefetched.has(e.href)&&e.origin===this.config.siteUrl&&-1===e.href.indexOf("?")&&-1===e.href.indexOf("#")&&!this.regex.excludeUris.test(e.href)&&!this.regex.images.test(e.href))}}],[{key:"run",value:function(){"undefined"!=typeof RocketPreloadLinksConfig&&new n(new RocketBrowserCompatibilityChecker({capture:!0,passive:!0}),RocketPreloadLinksConfig).init()}}]),n}();t.run();