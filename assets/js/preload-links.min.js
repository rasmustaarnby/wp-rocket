"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,h=e[Symbol.iterator]();!(r=(s=h.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&h.return&&h.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},e=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function n(e,t){r(this,n),this.browser=e,this.config=t,this.options=this.browser.options,this.prefetched=new Set,this.onhoverId=null,this.eventTime=null,this.threshold=1111,this.numOnHover=0,this.triggered=!1}return e(n,[{key:"init",value:function(){this.browser.supportsLinkPrefetch()&&!this.browser.isDataSaverModeOn()&&(this.regex={excludeUris:RegExp(this.config.excludeUris,"i"),images:RegExp(".("+this.config.imageExt+")$","i"),fileExtensions:RegExp(".("+this.config.fileExt+")$","i")},this._initListeners(this))}},{key:"_initListeners",value:function(e){-1<this.config.onHoverDelay&&document.addEventListener("mouseover",e.triggerOnHover.bind(e),e.options),document.addEventListener("mousedown",e.triggerOnClick.bind(e),e.options),document.addEventListener("touchstart",e.triggerOnTap.bind(e),e.options)}},{key:"_addPrefetchLink",value:function(e){var t;this.prefetched.has(e.href)||(this.prefetched.add(e.href),(t=document.createElement("link")).rel="prefetch",t.href=e.href,document.head.appendChild(t))}},{key:"triggerOnHover",value:function(e){var t,n,r,i,o=this;this.triggered||performance.now()-this.eventTime<this.threshold||(t=this._prepareUrl(e),n=s(t,2),r=n[0],i=n[1],null!==r&&(i.addEventListener("mouseout",this.resetOnHover.bind(this),{passive:!0}),this.onhoverId=setTimeout(function(){if(o.onhoverId=void 0,!o.triggered){if(0===o.numOnHover)setTimeout(function(){return o.numOnHover=0},1e3);else if(o.numOnHover>o.config.rateThrottle)return;o.numOnHover++,o._addPrefetchLink(r)}},this.config.onHoverDelay)))}},{key:"triggerOnClick",value:function(e){this.triggered=!0,this._reset();var t=this._prepareUrl(e),n=s(t,2),r=n[0];n[1];null!==r&&this._addPrefetchLink(r)}},{key:"triggerOnTap",value:function(e){this.eventTime=performance.now(),this.triggerOnClick(e)}},{key:"resetOnHover",value:function(e){(e.relatedTarget&&e.target.closest("a")===e.relatedTarget.closest("a")||this.onhoverId)&&this._reset()}},{key:"_prepareUrl",value:function(e){var t=e.target.closest("a");if(null===t||"object"!==(void 0===t?"undefined":o(t))||!1 in t||-1===["http:","https:"].indexOf(t.protocol))return[null,null];var n=t.href.substring(0,this.config.siteUrl.length),r=this._getPathname(t.href,n),i={original:t.href,protocol:t.protocol,origin:n,pathname:r,href:n+r};return this._isLinkOk(i)?[i,t]:[null,null]}},{key:"_getPathname",value:function(e,t){var n=t?e.substring(this.config.siteUrl.length):e;return n.startsWith("/")||(n="/"+n),this._shouldAddTrailingSlash(n)?n+"/":n}},{key:"_shouldAddTrailingSlash",value:function(e){return this.config.usesTrailingSlash&&!e.endsWith("/")&&!this.regex.fileExtensions.test(e)}},{key:"_isLinkOk",value:function(e){return null!==e&&"object"===(void 0===e?"undefined":o(e))&&(!this.prefetched.has(e.href)&&e.origin===this.config.siteUrl&&-1===e.href.indexOf("?")&&-1===e.href.indexOf("#")&&!this.regex.excludeUris.test(e.href)&&!this.regex.images.test(e.href))}},{key:"_reset",value:function(){this.onhoverId&&(clearTimeout(this.onhoverId),this.onhoverId=null)}}],[{key:"run",value:function(){"undefined"!=typeof RocketPreloadLinksConfig&&new n(new RocketBrowserCompatibilityChecker({capture:!0,passive:!0}),RocketPreloadLinksConfig).init()}}]),n}();t.run();